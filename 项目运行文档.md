# 项目运行文档

本文档详细说明如何配置和运行酒店入住管理系统。

---

## 一、环境要求

### 1.1 软件要求

| 软件 | 版本要求 | 说明 |
|------|----------|------|
| Python | 3.9+ | 推荐 3.10 或 3.12 |
| MySQL | 8.0+ | 关系型数据库 |
| pip | 最新版 | Python 包管理器 |

### 1.2 依赖包列表

项目依赖包定义在 `hotel_management/requirements.txt`:

```
django           # Web框架
pymysql          # MySQL驱动
mysqlclient      # MySQL驱动（二选一）
django-simpleui  # Admin界面美化
Pillow           # 图片处理
sqlalchemy       # SQL工具包
pandas           # 数据处理
numpy            # 数值计算
```

---

## 二、Python 安装

### 2.1 下载 Python

1. 访问 Python 官网: https://www.python.org/downloads/
2. 下载 Python 3.9 或更高版本
3. Windows 用户下载 "Windows installer (64-bit)"

### 2.2 安装 Python

1. 运行安装程序
2. **重要**: 勾选 "Add Python to PATH"
3. 点击 "Install Now"
4. 等待安装完成

### 2.3 验证安装

打开命令提示符或 PowerShell，执行：

```bash
python --version
```

应显示类似：`Python 3.12.0`

---

## 三、MySQL 安装与配置

### 3.1 安装 MySQL

1. 访问 MySQL 官网: https://dev.mysql.com/downloads/mysql/
2. 下载 MySQL Community Server
3. 运行安装程序，选择 "Server only" 或 "Developer Default"
4. 设置 root 密码（**请记住此密码**）

### 3.2 启动 MySQL 服务

**方法1 - 通过服务管理器:**
- 打开"服务"（Win+R 输入 `services.msc`）
- 找到 MySQL 服务并启动

**方法2 - 命令行启动:**

```bash
net start mysql
```

### 3.3 创建数据库

```bash
# 登录 MySQL
mysql -u root -p
# 输入密码后执行：

CREATE DATABASE hotel_management_db CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;

# 退出
exit;
```

---

## 四、项目配置

### 4.1 进入项目目录

```bash
cd C:\Users\你的用户名\Desktop\酒店入住管理系统\hotel_management
```

### 4.2 安装依赖包

```bash
pip install -r requirements.txt
```

**安装失败时使用国内镜像:**

```bash
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

**mysqlclient 安装失败的替代方案:**

```bash
pip install pymysql
```

然后编辑 `hotel_management/__init__.py`，添加：

```python
import pymysql
pymysql.install_as_MySQLdb()
```

### 4.3 修改数据库配置

编辑 `hotel_management/hotel_management/settings.py`，找到约第 82 行：

```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'hotel_management_db',
        'USER': 'root',
        'PASSWORD': 'admin',      # ← 改为你的 MySQL 密码
        'HOST': 'localhost',
        'PORT': '3306',
    }
}
```

将 `PASSWORD` 修改为你的 MySQL root 密码。

---

## 五、数据库初始化

### 方式一：使用 Django 迁移（推荐）

```bash
# 1. 执行迁移
python manage.py migrate

# 2. 创建管理员账户
python manage.py createsuperuser
# 按提示输入：用户名、邮箱、密码
```

**请记住用户名和密码，登录系统时需要！**

### 方式二：导入 SQL 文件

如果项目提供了 `hotel_management_db.sql` 文件：

```bash
mysql -u root -p hotel_management_db < ../hotel_management_db.sql
```

导入后默认账户：
- 用户名: `admin`
- 密码: `admin`

---

## 六、启动项目

### 6.1 启动开发服务器

```bash
python manage.py runserver
```

看到以下信息说明启动成功：

```
Django version 4.2.x, using settings 'hotel_management.settings'
Starting development server at http://127.0.0.1:8000/
Quit the server with CTRL-BREAK.
```

### 6.2 访问系统

打开浏览器访问：

| 页面 | 地址 |
|------|------|
| 登录页 | http://127.0.0.1:8000/admin/login/ |
| 管理后台 | http://127.0.0.1:8000/admin/ |

使用创建的管理员账户登录。

### 6.3 停止服务器

在命令行窗口按 `Ctrl+C`

---

## 七、基本使用

### 7.1 创建房间

1. 进入"酒店管理 → 房间管理"
2. 点击"增加房间"
3. 填写信息：房间号、类型、价格、设施、楼层、容纳人数
4. 点击"保存"

### 7.2 添加客户

1. 进入"酒店管理 → 顾客管理"
2. 点击"增加顾客"
3. 填写：姓名、身份证号、联系方式
4. 点击"保存"

### 7.3 创建预订

1. 进入"酒店管理 → 预定管理"
2. 点击"增加预订"
3. 选择客户、房间，填写入住/离店日期、人数
4. 状态选择"已预定"
5. 点击"保存"

**系统自动：**
- 计算金额：天数 × 房间价格
- 更新房间状态为"已预订"
- 创建收入记录

### 7.4 办理入住

1. 找到对应预订
2. 将状态改为"已入住"
3. 保存

→ 房间状态自动变为"已入住"

### 7.5 办理退房

1. 找到预订
2. 将状态改为"已离店"
3. 保存

→ 房间状态自动变为"空闲"

### 7.6 处理退订

1. 找到预订
2. 将状态改为"已退订"
3. 保存

**系统自动：**
- 创建全额退款记录
- 标记原收入为已退款
- 房间状态变为"空闲"

---

## 八、常见问题

### Q1: 提示 "No module named 'django'"

**解决：**

```bash
pip install django
```

### Q2: 无法连接数据库

```
django.db.utils.OperationalError: (2003, "Can't connect to MySQL server")
```

**检查：**
1. MySQL 服务是否启动？`net start mysql`
2. 数据库是否创建？登录 MySQL 执行 `SHOW DATABASES;`
3. settings.py 中密码是否正确？

### Q3: 数据库不存在

```
django.db.utils.InternalError: (1049, "Unknown database 'hotel_management_db'")
```

**解决：**

```bash
mysql -u root -p
CREATE DATABASE hotel_management_db CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
exit;
```

### Q4: 忘记管理员密码

```bash
# 方法1：创建新管理员
python manage.py createsuperuser

# 方法2：重置密码
python manage.py shell
```

```python
from django.contrib.auth.models import User
user = User.objects.get(username='admin')
user.set_password('new_password')
user.save()
exit()
```

### Q5: 端口被占用

```
Error: That port is already in use.
```

**解决：** 使用其他端口

```bash
python manage.py runserver 8080
```

然后访问 http://127.0.0.1:8080/admin/

### Q6: 图片无法显示

**检查：**
1. `media/pictures/` 目录是否存在
2. 是否已上传图片

**创建目录：**

```bash
mkdir media
mkdir media\pictures
```

### Q7: 页面显示乱码

**解决：** 重新创建数据库

```sql
DROP DATABASE hotel_management_db;
CREATE DATABASE hotel_management_db CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
```

然后重新执行 `python manage.py migrate`

---

## 九、进阶操作

### 9.1 自定义端口

```bash
# 默认端口 8000
python manage.py runserver

# 自定义端口 8080
python manage.py runserver 8080

# 允许外部访问
python manage.py runserver 0.0.0.0:8000
```

### 9.2 Django Shell

```bash
python manage.py shell
```

在 Shell 中操作数据：

```python
from rooms.models import Room
Room.objects.all()

from reservations.models import Reservation
Reservation.objects.filter(status='Booked')
```

### 9.3 数据导出

```bash
# 导出所有数据
python manage.py dumpdata > backup.json

# 导出特定应用
python manage.py dumpdata rooms > rooms_backup.json
```

### 9.4 数据导入

```bash
python manage.py loaddata backup.json
```

### 9.5 数据库备份

```bash
mysqldump -u root -p hotel_management_db > backup_$(date +%Y%m%d).sql
```

---

## 十、生产环境部署

### 10.1 修改配置

编辑 `settings.py`:

```python
# 关闭调试模式
DEBUG = False

# 设置允许的主机
ALLOWED_HOSTS = ['your-domain.com', 'your-ip']

# 使用安全的 SECRET_KEY
SECRET_KEY = 'your-secure-secret-key'
```

### 10.2 收集静态文件

```bash
python manage.py collectstatic
```

### 10.3 使用 Gunicorn

```bash
pip install gunicorn
gunicorn hotel_management.wsgi:application --bind 0.0.0.0:8000
```

### 10.4 使用 Nginx

配置 Nginx 作为反向代理，处理静态文件和媒体文件。

---

## 十一、运行检查清单

启动前请确认：

- [ ] Python 3.9+ 已安装
- [ ] MySQL 已安装并启动
- [ ] 数据库 `hotel_management_db` 已创建
- [ ] 依赖包已安装 (`pip install -r requirements.txt`)
- [ ] 数据库密码已配置 (`settings.py`)
- [ ] 数据库迁移已执行 (`python manage.py migrate`)
- [ ] 管理员账户已创建 (`python manage.py createsuperuser`)

启动命令：

```bash
cd hotel_management
python manage.py runserver
```

访问 http://127.0.0.1:8000/admin/ 开始使用！

---

## 十二、相关文档

- **项目介绍**: `项目介绍文档.md` - 功能说明与使用指南
- **开发文档**: `酒店入住管理系统开发文档.md` - 技术架构与代码说明

## 十三、技术支持

遇到问题时：

1. 查看本文档的"常见问题"章节
2. 查看 Django 官方文档: https://docs.djangoproject.com/zh-hans/4.2/
3. 检查错误提示信息，大部分问题都能通过错误信息定位
