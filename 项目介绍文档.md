# 酒店入住管理系统 - 项目介绍

## 一、项目简介

### 1.1 系统概述

酒店入住管理系统是一个基于 **Python Django 4.2** 框架开发的酒店后台管理系统，采用 **Django Admin + SimpleUI** 作为管理界面。系统专为中小型酒店设计，提供房间管理、客户管理、预订管理、财务管理、员工管理等核心功能。

### 1.2 核心功能

| 功能模块 | 说明 |
|----------|------|
| 房间管理 | 房间信息维护、状态查看、图片上传 |
| 客户管理 | 客户档案录入与管理 |
| 预订管理 | 预订创建、入住办理、退房办理、退订处理 |
| 财务管理 | 收入支出记录、自动财务联动 |
| 员工管理 | 员工信息与工资管理 |

### 1.3 系统亮点

1. **业务自动化**: 预订创建时自动计算金额、自动记录收入、自动同步房间状态
2. **智能退款**: 退订时自动创建全额退款记录，并标记原收入
3. **删除保护**: 有活跃订单的房间/客户无法删除，活跃订单无法直接删除
4. **数据校验**: 日期冲突检测、人数容量校验、金额非负验证
5. **批量操作**: 支持批量入住、批量退房、批量退订


## 二、技术架构

### 2.1 技术栈

| 技术组件 | 说明 |
|----------|------|
| Python 3.9+ | 编程语言 |
| Django 4.2 | Web框架 |
| MySQL 8.0+ | 数据库 |
| django-simpleui | Admin界面美化 |
| Pillow | 图片处理（房间图片上传） |
| PyMySQL/mysqlclient | MySQL数据库驱动 |

### 2.2 项目结构

```
hotel_management/
├── manage.py                    # Django管理脚本
├── requirements.txt             # 依赖包列表
├── hotel_management/            # 项目配置
│   ├── settings.py              # 全局配置
│   ├── urls.py                  # URL路由
│   └── views.py                 # 自定义视图
├── rooms/                       # 房间管理应用
│   ├── models.py                # Room模型
│   └── admin.py                 # 房间Admin配置
├── customers/                   # 客户管理应用
│   ├── models.py                # Customer模型
│   └── admin.py                 # 客户Admin配置
├── reservations/                # 预订管理应用（核心）
│   ├── models.py                # Reservation模型（含核心业务逻辑）
│   └── admin.py                 # 预订Admin配置
├── finance/                     # 财务管理应用
│   ├── models.py                # Income/Expense模型
│   └── admin.py                 # 财务Admin配置
├── employees/                   # 员工管理应用
│   ├── models.py                # Employee模型
│   └── admin.py                 # 员工Admin配置
├── templates/                   # 模板目录
└── media/pictures/              # 房间图片存储
```

### 2.3 系统架构图

```
┌─────────────────────────────────────────────────┐
│              用户界面层 (Django Admin)            │
│                SimpleUI 主题美化                  │
└────────────────────────┬────────────────────────┘
                         │
┌────────────────────────┴────────────────────────┐
│                   业务逻辑层                      │
│  ┌────────┬────────┬──────────┬────────┬──────┐ │
│  │ rooms  │customer│reservation│finance │employ│ │
│  │ 房间   │ 客户   │ 预订(核心) │ 财务   │ 员工 │ │
│  └────────┴────────┴──────────┴────────┴──────┘ │
└────────────────────────┬────────────────────────┘
                         │
┌────────────────────────┴────────────────────────┐
│               数据持久层 (Django ORM)             │
│                    MySQL 数据库                   │
└─────────────────────────────────────────────────┘
```


## 三、功能模块详解

### 3.1 房间管理 (rooms)

**数据字段**:

| 字段 | 类型 | 说明 |
|------|------|------|
| room_number | 字符串(3位) | 房间号（必须为3位数字，如101、202） |
| room_type | 选择项 | 单人间/双人间/套房/豪华间 |
| price | 正整数 | 每晚价格（必须≥1） |
| facilities | 文本 | 房间设施描述 |
| status | 选择项 | 空闲/已预订/已入住/维修中 |
| floor | 整数 | 所在楼层 |
| capacity | 整数 | 最大容纳人数 |
| description | 文本 | 房间描述（可选） |
| pictures | 图片 | 房间主图（可选） |

**状态说明**:
- **Available (空闲)**: 可预订状态
- **Booked (已预订)**: 已被预订，等待入住
- **Occupied (已入住)**: 客人正在使用
- **Maintenance (维修中)**: 需手动设置，系统不自动修改

**业务规则**:
- 房间号必须是3位数字（如：101、202、303）
- 房间状态由预订系统自动维护（维修中除外）
- 有活跃订单（已预定/已入住）的房间无法删除或修改
- 价格必须为正整数（≥1）


### 3.2 客户管理 (customers)

**数据字段**:

| 字段 | 类型 | 说明 |
|------|------|------|
| name | 字符串 | 客户姓名 |
| id_number | 字符串(18位) | 身份证号（18位，唯一，有格式验证） |
| phone | 字符串(11位) | 手机号（11位，有格式验证，如：13812345678） |
| email | 邮箱 | 电子邮箱（可选） |
| address | 文本 | 家庭地址（可选） |

**业务规则**:
- 身份证号必须为有效的18位格式
- 手机号必须为有效的11位格式（1开头）
- 身份证号全局唯一
- 有活跃订单的客户无法删除
- 有已入住订单的客户无法修改信息


### 3.3 预订管理 (reservations) - 核心模块

**数据字段**:

| 字段 | 类型 | 说明 |
|------|------|------|
| customer | 外键 | 关联客户 |
| room | 外键 | 关联房间 |
| check_in_date | 日期 | 入住日期 |
| check_out_date | 日期 | 离店日期 |
| number_of_guests | 正整数 | 入住人数（1-100） |
| special_requests | 文本 | 特殊要求（可选） |
| status | 选择项 | 已预定/已入住/已离店/已退订 |
| paid_amount | 金额 | 已付金额（自动计算） |
| income_recorded | 布尔 | 是否已记录收入 |
| refund_recorded | 布尔 | 是否已处理退款 |
| refund_amount | 金额 | 退款金额 |

**状态流转**:

```
已预定 (Booked)
    ├──→ 已入住 (CheckedIn) ──→ 已离店 (CheckedOut)
    └──→ 已退订 (Refunded)
```

**自动化机制**:

1. **金额自动计算**: `paid_amount = (check_out_date - check_in_date) × room.price`
2. **房间状态同步**: 保存时自动更新房间状态
3. **收入自动记录**: 创建预订后自动在 Income 表创建客房收入
4. **退款自动处理**: 状态改为已退订时，自动创建 Expense 退款记录
5. **超期自动离店**: 已入住且超过离店日期的订单自动变为已离店

**数据校验**:
- 入住日期必须早于离店日期
- 入住人数不能超过房间容量
- 同一房间同一时段不能重复预订（日期冲突检测）

**删除保护**:
- 活跃订单（已预定/已入住）无法删除
- 删除时自动处理退款和收入记录标记


### 3.4 财务管理 (finance)

**Income (收入)**:

| 字段 | 说明 |
|------|------|
| date | 收入日期 |
| amount | 金额（正整数，≥1） |
| source | 来源：客房收入/餐饮收入/其他收入 |
| description | 描述 |

**Expense (支出)**:

| 字段 | 说明 |
|------|------|
| date | 支出日期 |
| amount | 金额（正整数，≥1） |
| category | 类别：员工工资/维修费用/水电费/其他支出 |
| description | 描述 |

**自动联动**:
- 预订创建时自动生成「客房收入」记录
- 预订退订时自动生成「其他支出」退款记录


### 3.5 员工管理 (employees)

**数据字段**:

| 字段 | 说明 |
|------|------|
| name | 员工姓名 |
| position | 职位（前台/后厨/保洁/保安/经理） |
| phone | 联系电话（11位手机号，有格式验证） |
| email | 邮箱（可选） |
| address | 地址（可选） |
| salary | 月工资（正整数，≥1） |
| hire_date | 入职日期 |
| status | 在职状态（在职/离职，默认在职） |


## 四、核心业务流程

### 4.1 预订入住流程

```
1. 添加客户（如新客户）
       ↓
2. 创建预订（选择客户、房间、日期）
       ↓
   ┌──────────────────────────────┐
   │ 系统自动:                      │
   │ • 计算金额                     │
   │ • 更新房间状态为「已预订」       │
   │ • 创建收入记录                  │
   └──────────────────────────────┘
       ↓
3. 办理入住（状态改为「已入住」）
       ↓
   → 房间状态自动更新为「已入住」
       ↓
4. 办理退房（状态改为「已离店」）
       ↓
   → 房间状态自动更新为「空闲」
```

### 4.2 退订流程

```
预订状态改为「已退订」
       ↓
   ┌──────────────────────────────┐
   │ 系统自动:                      │
   │ • 创建全额退款支出记录           │
   │ • 标记原收入记录为已退款         │
   │ • 更新房间状态为「空闲」         │
   └──────────────────────────────┘
```

### 4.3 批量操作

系统支持以下批量操作（在预订列表页面）:
- **批量办理入住**: 将选中的「已预定」订单改为「已入住」
- **批量办理离店**: 将选中的「已入住」订单改为「已离店」
- **批量退订(自动退款)**: 将选中订单改为「已退订」并自动退款


## 五、系统访问

### 5.1 访问地址

| 页面 | URL |
|------|-----|
| 登录页 | http://127.0.0.1:8000/admin/login/ |
| 管理后台 | http://127.0.0.1:8000/admin/ |

### 5.2 后台菜单结构

```
├── 酒店管理
│   ├── 房间管理
│   ├── 顾客管理
│   └── 预定管理
├── 财务管理
│   ├── 收入管理
│   └── 支出管理
├── 员工管理
│   └── 员工管理
└── 系统管理
    └── 管理员管理
```


## 六、数据关系

```
┌──────────────┐
│   Customer   │
│    (客户)    │
└──────┬───────┘
       │ 1:N
       ↓
┌──────────────┐       ┌──────────────┐
│ Reservation  │ N:1   │     Room     │
│   (预订)     │←─────→│    (房间)    │
└──────┬───────┘       └──────────────┘
       │
       │ 自动创建
       ↓
┌──────────────┐       ┌──────────────┐
│    Income    │       │   Expense    │
│   (收入)     │       │   (支出)     │
└──────────────┘       └──────────────┘
```


## 七、注意事项

### 7.1 删除保护机制

| 数据类型 | 保护条件 |
|----------|----------|
| 房间 | 存在活跃订单（已预定/已入住）时无法删除 |
| 客户 | 存在活跃订单时无法删除 |
| 预订 | 活跃订单无法删除，需先改为已离店或已退订 |

### 7.2 数据验证规则

- 房间号必须为3位数字（如：101、202）
- 身份证号必须为有效的18位格式
- 手机号必须为有效的11位格式
- 入住日期必须早于离店日期
- 入住人数范围: 1-100，且不超过房间容量
- 金额字段（价格、工资等）必须为正整数（≥1）
- 身份证号、房间号必须唯一
- 同房间同时段不能重复预订

### 7.3 操作建议

1. 新建预订时，系统只显示「空闲」状态的房间
2. 已离店的订单无法修改状态或退款
3. 客房收入由系统自动创建，建议不要手动修改
4. 退订操作不可撤销，请谨慎操作


## 八、快速开始

```bash
# 1. 安装依赖
cd hotel_management
pip install -r requirements.txt

# 2. 配置数据库 (修改 settings.py 中的 DATABASES)

# 3. 创建数据库
mysql -u root -p -e "CREATE DATABASE hotel_management_db CHARACTER SET utf8mb4;"

# 4. 执行迁移
python manage.py migrate

# 5. 创建管理员
python manage.py createsuperuser

# 6. 启动服务
python manage.py runserver

# 7. 访问 http://127.0.0.1:8000/admin/
```


## 九、相关文档

- **开发文档**: `酒店入住管理系统开发文档.md` - 详细技术实现说明
- **运行文档**: `项目运行文档.md` - 环境配置与部署指南
